# Story 2.1: Agent Properties List API

**Epic:** 2. Property Management & Admin
**Status:** Done Since 2026-01-14

## Story Statement
As an agent, I want to retrieve my property listings so that I can see what I've created.

## Acceptance Criteria
1. **Endpoint**: `GET /api/v1/properties/mine`
2. **Authorization**: Only accessible by authenticated users (Agents/Admins).
3. **Filtering**:
    - Returns only properties where `agent_id` matches the current user's ID.
    - Optional query parameter `status` (e.g., `?status=published`) filters by status.
4. **Sorting**:
    - Default sort: `created_at` descending (newest first).
    - Optional query parameter `sort` (values: `created_at`, `price`).
5. **Response**: 
    - Returns JSON array of property objects.
    - Includes all property fields (title, price, status, images, etc.).
    - Returns empty array `[]` if no properties found.

## Dev Notes
- **File Locations**:
    - Route handler: `backend/app/api/v1/properties.py`
    - CRUD operation: `backend/app/crud/crud_property.py` (add `get_multi_by_owner`)
- **Dependencies**:
    - Use `FastAPI` dependency `get_current_user` to get `agent_id`.
- **Query Parameters**:
    - Use `FastAPI` `Query` for optional params.
- **SQLAlchemy**:
    - Use `select(Property).where(Property.agent_id == user_id)`.
    - Apply filters conditionally.
    - Apply `order_by`.

## Tasks
- [x] **CRUD Layer**:
    - [x] Update `backend/app/crud/crud_property.py` to add `get_multi_by_owner(db, owner_id, status, sort)`.
- [x] **API Endpoint**:
    - [x] Add `GET /mine` endpoint in `backend/app/api/v1/properties.py`.
    - [x] Connect endpoint to CRUD function.
- [x] **Testing**:
    - [x] Create test `backend/tests/api/v1/test_properties_list.py`.
    - [x] Test with agent who has properties.
    - [x] Test with agent who has NO properties.
    - [x] Test status filtering.
    - [x] Verify non-owners cannot see others' properties via this endpoint.
