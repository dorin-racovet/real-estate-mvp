# Story 1.3: Authentication System

**Epic:** 1. Foundation & Authentication
**Status:** Done

## Story Statement
As an agent or admin, I want to log in with email and password, so that I can access protected features.

## Acceptance Criteria
1. `POST /api/auth/login` accepts email and password, returns JWT token
2. JWT token includes user_id, email, role, and expiration (24h)
3. Passwords verified using bcrypt
4. Invalid credentials return 401 with error message
5. `GET /api/auth/me` returns current user info (requires valid token)
6. Protected routes return 401 if no token or invalid token
7. Token refresh not required for MVP (24h expiry sufficient)
8. CORS configured to allow frontend origin

## Dev Notes
- **Security Implementation**:
    - Location: `app/core/security.py`.
    - Key dependencies: `passlib[bcrypt]`, `python-jose` (or `pyjwt` based on requirements). NOTE: Requirements uses `pyjwt` and `bcrypt`.
    - Functionality: `verify_password`, `get_password_hash`, `create_access_token`, `verify_token`. [Source: architecture/8-authentication-flow.md]
    - Configuration: `SECRET_KEY`, `ALGORITHM` (HS256), `ACCESS_TOKEN_EXPIRE_MINUTES`. [Source: architecture/8-authentication-flow.md]
- **API Endpoints**:
    - Location: `app/api/v1/auth.py`.
    - `POST /login`: Request body (email, password) -> Response (access_token, token_type). [Source: architecture/3-api-specifications.md]
    - `GET /me`: Secured dependency -> Response (UserRead). [Source: architecture/3-api-specifications.md]
- **Dependencies**:
    - Location: `app/api/dependencies.py`.
    - `get_current_user`: Depends on OAuth2PasswordBearer, verifies token, fetches user from DB. [Source: architecture/8-authentication-flow.md]
    - `get_current_active_user`: Validates user status (if applicable).
- **Schemas**:
    - Location: `app/schemas/auth.py` (Token, TokenData, Login).
    - Location: `app/schemas/user.py` (UserRead).

## Tasks
- [ ] **Core Security**:
    - [ ] Create `app/core/security.py` using `pyjwt` and `bcrypt`.
    - [ ] Implement password hashing and verification functions.
    - [ ] Implement JWT token creation and validation functions.
- [ ] **Schemas**:
    - [ ] Create `app/schemas/auth.py` (Token, Login schemas).
    - [ ] Create `app/schemas/user.py` (UserRead schema).
- [ ] **API Dependencies**:
    - [ ] Create `app/api/dependencies.py`.
    - [ ] Implement `get_current_user` dependency with OAuth2PasswordBearer.
- [ ] **Endpoints**:
    - [ ] Create `app/api/v1/auth.py`.
    - [ ] Implement `POST /login` endpoint.
    - [ ] Implement `GET /me` endpoint using `get_current_user`.
    - [ ] Register auth router in `app/api/__init__.py`.
