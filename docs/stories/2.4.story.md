# Story 2.4: Agent Dashboard Properties Table

**Epic:** 2. Property Management & Admin
**Status:** Done Since 2026-01-14

## Story Statement
As an agent, I want to see a table of my properties on the dashboard, so that I can manage my listings.

## Acceptance Criteria
1. **Dashboard Integration**: Dashboard page (`/agent/dashboard` or similar) displays the properties table below the creation form logic (or as the main view).
2. **Table Columns**:
    - **Thumbnail**: First image of the property (or placeholder).
    - **Title**: Property title.
    - **Price**: Formatted price (e.g., $1,000,000).
    - **City**: Property location/city.
    - **Status**: Badge indicating `draft` (Yellow) or `published` (Green).
    - **Actions**: Edit, Toggle Status, Delete buttons.
3. **Status Badge**: Visually distinct styles for Draft vs Published.
4. **Action Interactions**:
    - **Toggle Status**: Switches draftâ†”published (Requires confirmation).
    - **Delete**: Removes property (Requires confirmation).
    - **Edit**: Navigates to edit page (Scope of Story 2.5, but button checks existence).
5. **State Updates**: Table updates automatically after actions (optimistic or re-fetch) without full page reload.
6. **Empty State**: Displays a friendly message ("No properties found. Create your first one!") if the list is empty.

## Dev Notes
- **API Dependencies**:
    - `GET /api/v1/properties/mine` (Implemented in Story 2.1).
    - `PATCH /api/v1/properties/{id}/status` (Pending Story 2.2).
    - `DELETE /api/v1/properties/{id}` (Pending Story 2.2?).
    - **CRITICAL**: Since backend endpoints for Status Toggle and Delete might not be ready, implement the **UI and Handlers** but mock the API call or leave as `console.log("TODO: Connect API")` for this story. Focus on the **Read** and **Display** aspect.
- **Frontend Architecture**:
    - **API Layer**: Update `src/api/properties.ts`.
    - **Hooks**: Update/Create `src/hooks/useProperties.ts` to include `useMyProperties`.
    - **Components**: Create `src/components/property/PropertyTable.tsx`.
    - **Page**: Update `src/pages/agent/DashboardPage.tsx` to include the table.
- **Data Models**:
    - `Property` interface in `src/types/property.ts` must match backend `PropertyRead` schema.
    - Fields: `id`, `title`, `price`, `surface`, `property_type`, `city`, `images`, `status`, `created_at`.

## Tasks
1. **Update API Client (`src/api/properties.ts`)**:
    - Add `getMyProperties()` function calling `GET /api/v1/properties/mine`.
    - Define return type `Property[]`.
2. **Update/Create Hook (`src/hooks/useProperties.ts`)**:
    - Create `useMyProperties` hook using `react-query` (or `useEffect` + state) to fetch data.
    - Handle `loading` and `error` states.
3. **Create Component (`src/components/property/PropertyTable.tsx`)**:
    - UI implementation of the table.
    - Accept `properties` as prop.
    - Implement rows and columns as per AC.
    - Add `Action` buttons (stub `onEdit`, `onDelete`, `onStatusChange` handlers).
4. **Integrate into Dashboard (`src/pages/agent/DashboardPage.tsx`)**:
    - Import `useMyProperties`.
    - Render `PropertyTable` with data.
    - Handle Loading/Error states (Spinner/Toast).
    - Implement "Empty State" view.
5. **Verification**:
    - Login as agent.
    - Verify properties created in previous steps appear in the list.
    - Check formatting (Price, Date).
    - Check Status Badge colors.

