# Story 1.4: Agent Registration by Admin

**Epic:** 1. Foundation & Authentication
**Status:** Done

## Story Statement
As an admin, I want to create agent accounts, so that agents can access the platform.

## Acceptance Criteria
1. `POST /api/admin/agents` creates new agent user (admin only)
2. Request body: email, password, name, phone (optional)
3. Email uniqueness enforced, returns 400 if duplicate
4. Password hashed before storage
5. Returns created agent (without password_hash)
6. `GET /api/admin/agents` lists all agents (admin only)
7. Non-admin requests return 403 Forbidden

## Dev Notes
- **API Endpoints**:
    - Location: `app/api/v1/admin.py`.
    - `POST /agents`: Requires `get_current_active_admin` dependency. Request: `UserCreate`. Response: `UserRead`.
    - `GET /agents`: Requires `get_current_active_admin` dependency. Response: `List[UserRead]`. [Source: architecture/3-api-specifications.md]
- **Dependencies**:
    - Location: `app/api/dependencies.py`.
    - `get_current_admin`: Validates that `current_user.role == UserRole.ADMIN`.
- **Schemas**:
    - `UserCreate` (email, password, name, phone). [Source: architecture/5-pydantic-schemas.md]
    - `UserRead` (already exists).
- **CRUD Operations**:
    - Location: `app/crud/crud_users.py`.
    - `create_user`: Hashes password, saves to DB.
    - `get_user_by_email`: Check uniqueness.
    - `get_all_agents`: Filter by role='agent'.

## Tasks
- [ ] **Dependencies**:
    - [ ] Implement `get_current_admin` in `app/api/dependencies.py`.
- [ ] **CRUD**:
    - [ ] Create `app/crud/crud_users.py`.
    - [ ] Implement `get_by_email`, `create`, and `get_multi_by_role`.
- [ ] **Endpoints**:
    - [ ] Create `app/api/v1/admin.py`.
    - [ ] Implement `POST /agents` (with duplicate check and hashing).
    - [ ] Implement `GET /agents`.
    - [ ] Register admin router in `app/api/__init__.py`.
