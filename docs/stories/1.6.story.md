# Story 1.6: Image Upload for Properties

**Epic:** 1. Foundation & Authentication
**Status:** Done

## Story Statement
As an agent, I want to upload images for my property, so that buyers can see photos of the listing.

## Acceptance Criteria
1. `POST /api/v1/properties/{id}/images` uploads images (multipart/form-data)
2. Accepts multiple files in single request (up to 10)
3. Validates file types: jpg, jpeg, png, webp
4. Validates file size: max 10MB per file
5. Images saved to `backend/uploads/{property_id}/` (ensure directory exists)
6. Property `images` array updated with file paths (relative URLs)
7. Authorization: Only property owner or admin can upload
8. Returns updated property object
9. 404 if property not found

## Dev Notes
- **API Endpoints**:
    - Location: `app/api/v1/properties.py` (add to existing router).
    - `POST /{id}/images`:
        - Dependency: `get_current_user`.
        - Dependency: `crud_property.get_property` (need to implement `get` or `get_by_id`).
- **File Handling**:
    - Use `shutil.copyfileobj` to save `UploadFile` content.
    - Generate unique filenames (uuid or timestamp) to avoid collisions if needed, or keep original if safe.
    - Validate `file.content_type` AND extension.
- **Dependencies**:
    - `python-multipart` is already installed.
    - `Pillow` installed (maybe for validation/resize? MVP just storage).
- **CRUD Operations**:
    - `app/crud/crud_property.py`:
        - `get_property(id)`: Need to fetch property to check ownership.
        - `update_property_images(id, image_list)`: Update the JSON field.

## Tasks
- [ ] **CRUD**:
    - [ ] Update `app/crud/crud_property.py` with `get` and `update` logic (specifically `add_images`).
- [ ] **Endpoints**:
    - [ ] Update `app/api/v1/properties.py`.
    - [ ] Add `POST /{id}/images` endpoint.
    - [ ] Implement file validation size/type.
    - [ ] Implement file saving logic.
- [ ] **System**:
    - [ ] Ensure `backend/uploads` directory is created/exists on startup or first write.
